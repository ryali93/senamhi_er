var power_regression = function(x,y){
	var n = x.length;
	var lr = {};
	var sumX = 0;
	var sumX2 = 0;
	var sumY = 0;
	var sumXY = 0
	for(i=0;i<=n-1;i++){
	    sumX = sumX + Math.log(x[i]);
	    sumX2 = sumX2 + Math.log(x[i])*Math.log(x[i]);
	    sumY = sumY + Math.log(y[i]);
	    sumXY = sumXY + Math.log(y[i])*Math.log(x[i]);
	}
	var b = (n*sumXY - sumX*sumY)/(n*sumX2 - sumX*sumX);
	var A = (sumY - b*sumX)/n
	var a = Math.exp(A);
	lr["a"] = a;
	lr["b"] = b;
	return(lr)
}

var create_intensity = function(T,d,k,m,n){
	var I = k*(T**m)/(d**n)
	return(I)
}

var datos_idf_update = function(datos){
	var x = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];
	var trs = [2,5,10,30,50,75,100,200,500,1000];

	var lr;
	var coef = [];
	var expon = [];
	var lr_pr;
	var k,T,m,d,n;
	for(m in datos){
	    lr = power_regression(x, datos[m].map(parseFloat))
	    coef.push(lr["a"]);
	    expon.push(lr["b"]);
	}
	lr_pr = power_regression(trs, coef);
	k = lr_pr["a"];
	m = lr_pr["b"];
	n = -1*expon.reduce((a,v,i)=>(a*i+v)/(i+1));

	var intens = {};
	for(T in trs){
		intens["TR"+trs[T]] = [];
		for(d=1;d<=24;d++){
			intens["TR"+trs[T]].push(create_intensity(trs[T],d,k,m,n));
		}
	}
	return(intens);
}



datos_hietograma = {
	"TR2" : [3.08,3.02,2.98,2.94,2.89,2.85,2.79,2.74,2.66,2.58,2.48,2.39,2.30,2.22,2.15,2.08,2.02,1.96,1.91,1.87,1.83,1.78,1.75,1.71],
	"TR5" : [3.84,3.77,3.72,3.66,3.61,3.56,3.48,3.42,3.31,3.22,3.10,2.98,2.87,2.77,2.68,2.59,2.52,2.45,2.39,2.33,2.28,2.23,2.18,2.14],
	"TR10" : [4.28,4.19,4.15,4.08,4.02,3.97,3.88,3.81,3.69,3.58,3.45,3.31,3.19,3.08,2.99,2.89,2.80,2.73,2.66,2.60,2.54,2.48,2.43,2.38],
	"TR30" : [4.86,4.76,4.71,4.63,4.56,4.50,4.41,4.32,4.19,4.07,3.92,3.76,3.62,3.50,3.39,3.28,3.18,3.10,3.02,2.95,2.88,2.82,2.75,2.70],
	"TR50" : [5.35,5.24,5.18,5.10,5.02,4.96,4.85,4.76,4.61,4.48,4.31,4.14,3.99,3.85,3.73,3.61,3.50,3.41,3.32,3.25,3.17,3.10,3.03,2.97],
	"TR75" : [5.55,5.44,5.37,5.29,5.21,5.14,5.03,4.94,4.78,4.64,4.47,4.30,4.14,3.99,3.87,3.74,3.63,3.53,3.44,3.36,3.29,3.21,3.14,3.08],
	"TR100" : [5.83,5.72,5.65,5.56,5.47,5.40,5.29,5.19,5.03,4.88,4.70,4.52,4.35,4.20,4.07,3.94,3.82,3.72,3.62,3.54,3.46,3.38,3.31,3.24],
	"TR200" : [6.35,6.23,6.15,6.06,5.96,5.89,5.76,5.65,5.48,5.32,5.12,4.92,4.74,4.57,4.43,4.29,4.16,4.05,3.95,3.85,3.77,3.68,3.60,3.53],
	"TR500" : [7.08,6.93,6.86,6.75,6.64,6.56,6.42,6.30,6.10,5.92,5.70,5.48,5.28,5.09,4.94,4.78,4.63,4.51,4.39,4.29,4.20,4.10,4.01,3.93],
	"TR1000" : [7.55,7.40,7.32,7.20,7.09,7.00,6.85,6.72,6.51,6.32,6.09,5.85,5.63,5.44,5.27,5.10,4.94,4.81,4.69,4.58,4.48,4.37,4.28,4.19]
}




