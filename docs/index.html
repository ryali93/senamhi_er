<!DOCTYPE html>
<html lang="en" class="no-js"><!--<![endif]-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="Antero Matos Zabarburu" name="author" />
    <meta content="Visor de Informacion Espacial del SENAMHI-PERU" name="description" />
    <link rel="icon" href="assets/img/ide/favicon.ico">
    <title>IDESEP</title>
    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    
    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    <link href="assets/plugins/jquery-ui/themes/base/minified/jquery-ui.min.css" rel="stylesheet" />
    <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="assets/css/animate.min.css" rel="stylesheet" />
    <link href="assets/css/style.min.css" rel="stylesheet" />
    <link href="assets/css/style-responsive.min.css" rel="stylesheet" />
    <link href="assets/css/theme/default.css" rel="stylesheet" id="theme" />

    <link href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/css/ol.css" rel="stylesheet">
    <link href="assets/css/ol3-sidebar.css" rel="stylesheet"/>

    <!-- ================== END BASE CSS STYLE ================== -->
    <!-- ================== END BASE CSS STYLE ================== -->
    <!-- ================== BEGIN BASE JS ================== -->
    
    <!-- ================== BEGIN BASE JS ================== -->
    <script src="assets/plugins/pace/pace.min.js"></script>
    <!-- ================== END BASE JS ================== -->
    <!-- ================== END BASE JS ================== -->
    <!-- ================== BEGIN OL3 ================== -->
    <link type="text/css" rel="stylesheet" href="assets/plugins/openlayer/ol3/3.17.1/css/ol.css">
    <script type="text/javascript" src="assets/plugins/openlayer/ol3/3.17.1/js/ol.js"></script>
    <script type="text/javascript" src="assets/plugins/openlayer/src/proj4js/proj4.js"></script>
    <!-- <script type="text/javascript" src="https://unpkg.com/elm-pep.js"></script> -->
    <script type="text/javascript" src="getfeatureinfo-image.js"></script>

    <!--
    <link type="text/css" rel="stylesheet" href="assets/plugins/openlayer/src/ol3-layerswitcher/ol3-layerswitcher.css"/>
    <script type="text/javascript" src="assets/plugins/openlayer/src/ol3-layerswitcher/ol3-layerswitcher.js"></script>
    -->
    <link type="text/css" rel="stylesheet" href="assets/plugins/openlayer/canvas/control/layerswitchercontrol.css"/>
    <script type="text/javascript" src="assets/plugins/openlayer/canvas/control/layerswitchercontrol.js"></script>
    <script type="text/javascript" src="assets/plugins/openlayer/canvas/control/canvasscalelinecontrol.js"></script>
    <script type="text/javascript" src="assets/plugins/openlayer/canvas/interaction/clipinteraction.js"></script>
    <link type="text/css" rel="stylesheet" href="assets/plugins/openlayer/src/ol3-popup-master/src/ol3-popup.css">
    <script type="text/javascript" src="assets/plugins/openlayer/src/ol3-popup-master/src/ol3-popup.js"></script>

    <script type="text/javascript" src="assets/data.json"></script>
    <script type="text/javascript" src="assets/q_pp.json"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

    <!-- ================== END OL3 ================== -->
    <!-- Swipe -->
    <!-- <link rel="stylesheet" href="http://viglino.github.io/ol3-ext/control/swipecontrol.css" type="text/css" />
    <script type="text/javascript" src="http://viglino.github.io/ol3-ext/control/swipecontrol.js"></script> -->
    <!-- ================== BEGIN PAGE LEVEL CSS ================== -->
    <link type="text/css" rel="stylesheet" href="assets/css/styleSheet1.css">
    <!-- ================== END PAGE LEVEL CSS ==================== -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-9445737-10"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-9445737-10');
    </script> -->
</head>
<body style="overflow:hidden;">
    <!-- begin #variables globales -->
    
    <input type="hidden" id="modoVisualizarCapaTematica" value=""/>
    <input type="hidden" id="radius" value=""/>
    <!-- end   #page-loader -->
    <!-- begin #page-loader -->
    
    <div id="page-loader" class="fade in"><span class="spinner"></span></div>
    <!-- end #page-loader -->
    <!-- begin #page-container -->
    <div id="page-container" class="page-container fade page-sidebar-fixed page-header-fixed">
        <!-- begin #header -->
        
        <div id="header" class="header navbar navbar-default navbar-fixed-top">
            <!-- begin container-fluid -->
            <div class="container-fluid">
                <!-- begin mobile sidebar expand / collapse button -->
                <div class="navbar-header">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <a href="//www.gob.pe/minam"  target="_blank" class="navbar-link"><img src="assets/img/ide/LOGO-MINAM-2016.png" alt="no disponible" style="margin: 0px 0px 0px 5px;"/></a>
                            <a href="//www.senamhi.gob.pe/" target="_blank" class="navbar-form"><img src="assets/img/ide/logo_senamhi.png" alt="no disponible" style="margin: 3px 0px 0px 0px;"/></a>
                            <button type="button" class="navbar-toggle" data-click="sidebar-toggled">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- end mobile sidebar expand / collapse button -->
                <!-- begin header navigation right -->
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="javascript:;" data-toggle="dropdown" class="dropdown-toggle f-s-14">
                            <i class="fa fa-bell-o f-s-18"></i>
                            <span class="label">2</span>
                        </a>
                        <ul class="dropdown-menu media-list pull-right animated fadeInDown">
                            <li class="dropdown-header">Aviso</li>
                            
                            
                            <li class="media">
                                <a href="go?accion=aviso243">
                                    <div class="media-left"><i class="fa fa-exclamation-triangle media-object bg-orange"></i></div> <!--bg-red-->
                                    <div class="media-body">
                                        <h6 class="media-heading">Precipitaciones en la sierra </h6>
                                        <div class="text-muted f-s-11">Nivel 03 - Aviso N&deg; 243</div>
                                        <p>36 horas - 25/11/2020</p>
                                    </div>
                                </a>
                            </li>
                            
                            <li class="media">
                                <a href="go?accion=aviso242">
                                    <div class="media-left"><i class="fa fa-exclamation-triangle media-object bg-orange"></i></div> <!--bg-red-->
                                    <div class="media-body">
                                        <h6 class="media-heading">Lluvia en la selva </h6>
                                        <div class="text-muted f-s-11">Nivel 03 - Aviso N&deg; 242</div>
                                        <p>54 horas - 25/11/2020</p>
                                    </div>
                                </a>
                            </li>
                            
                            
                            <li class="dropdown-footer text-center">
                                <a href="//www.senamhi.gob.pe/?p=avisos" target="_blank">Ver m&#225;s</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- end container-fluid -->
        </div>
        <!-- end #header -->
        <!-- begin #sidebar -->
        
        <div id="sidebar" class="sidebar" >
            <!-- begin sidebar scrollbar -->
            <div data-scrollbar="true" data-height="100%" >
                <!-- begin sidebar user -->
                <ul class="nav" style="margin-top: -10px">
                    <li class="nav-profile navbar-form">
                        <div class="image">
                            <a href="http://idesep.senamhi.gob.pe/geovisoridesep/"><img src="assets/img/ide/map_icon3.gif" alt="no disponible" /></a>
                        </div>
                        <div class="info "><a href="http://idesep.senamhi.gob.pe/portalidesep/" target="_blank" style="text-decoration:none; nounderline:link">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDESEP</a>
                        <small><cite>SENAMHI - PERU</cite></small>
                        </div>
                    </li>
                </ul>
            <!-- end sidebar user -->
            <!-- begin sidebar nav -->
                <ul class="nav" style="font-size: 95%">
                    <li class="nav-header"><a href="#">TEMAS</a></li>
                    <li class="has-sub"><a href="javascript:;"><b class="caret pull-right"></b><i class="fa fa-envira"></i><span>LLUVIAS EXTREMAS</span></a>
                        <ul class="sub-menu">
                            <li class="has-sub"><a href="javascript:;"><b class="caret pull-right"></b>Riesgo de Arroz (Ago)</a>
                                <ul class="sub-menu">
                                    <li><a href="go?accion=pnud_ra:ra_ppmean">Mensual de Arroz</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                <!-- begin sidebar minify button -->
                <li><a href="javascript:;" class="sidebar-minify-btn" data-click="sidebar-minify"><i class="fa fa-angle-double-left"></i></a></li>
                <!-- end sidebar minify button -->
            </ul>
            <!-- end sidebar nav -->
        </div>
        <!-- end sidebar scrollbar -->
    </div>
    <div class="sidebar-bg"></div>
    <!-- end #sidebar -->
    <!-- begin #content -->
    
    <!-- begin #content -->
    <div id="content" class="content content-full-width">
        <div class="map">
            <div id="map" class="height-full width-full"></div>
            <input type="hidden" id="proyeccion" value="EPSG:4326"/>
            <input type="hidden" id="extent" value="[-81.32812321186065, -18.350177324938613, -68.6519604921341, -0.039256808070482214]"/>
            <input type="hidden" id="presicion_decimal" value="12"/>
            <input type="hidden" id="key_bing_map" value="AhaJDO_bWhekq58C0nGLRkwJSMphRFDTYeccozENkqZTAAa1W0OgoaWmcgbPxatZ"/>
            <!-- <input type="hidden" id="url" value="http://idesep.senamhi.gob.pe/geoserver/g_00_02/wms"/> -->
            <input type="hidden" id="url" value="http://localhost:8081"/>
            <input type="hidden" id="lyr" value="g_00_02:00_02_002_03_000_000_0000_00_00"/>
            <input type="hidden" id="nomlyr" value="g_00_02:00_02_002_03_000_000_0000_00_00"/>
            <!-- <input type="hidden" id="dominio" value="http://idesep.senamhi.gob.pe"/> -->
            <input type="hidden" id="dominio" value="http://localhost:8081"/>

            <div id="sidebar_ol" class="sidebar_ol collapsed">
                <div class="sidebar_ol-tabs">
                    <ul role="tablist">
                        <li><a href="#lluvias" role="tab"><i class="fa fa-bars"></i></a></li>
                        <li><a href="#lluvias_graficos" role="tab"><i class="fa fa-bar-chart"></i></a></li>
                    </ul>
                    <ul role="tablist">
                        <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
                    </ul>
                </div>
                <div class="sidebar_ol-content">
                    <div class="sidebar_ol-pane" id="lluvias">
                        <h1 class="sidebar_ol-header">Módulo de Lluvias extremas<span class="sidebar_ol-close"><i class="fa fa-caret-left"></i></span></h1>
                        
                        <br>
                        <br>
                        <p>Retornar a la <b><a href="/">página principal</a></b></p>
                        <b>Consultar el <a href="/">manual de uso</a></b>
                        <br>
                        <br>
                        <div style="width: 100%;display: flex;">
                            <div style="width: 50%;">
                                <b>Subregion: </b><p id="infoRaster"></p>
                                <b>PP Máxima: </b><p id="infoVector"></p>
                            </div>
                            <div style="width: 50%;">
                                <p id="coord_x"><b>X (wgs84): </b></p>
                                <p id="coord_y"><b>Y (wgs84): </b></p>
                            </div>
                        </div>
                        
                        <!-- <pre id="info"/> -->

                        
                        <!-- <div id="container"></div> -->
                        <b>Seleccionar Quantil:</b>
                        <br>
                        <select id="select_quantil" style="width: 70%;">
                            <option value="Q1">Quantil 1</option>
                            <option value="Q2">Quantil 2</option>
                            <option value="Q3">Quantil 3</option>
                            <option value="Q4">Quantil 4</option>
                        </select>
                        <br><br>
                        <b>Seleccionar Percentil:</b>
                        <br>
                        <select id="select_percentil" style="width: 70%;">
                            <option value="P10">Percentil 10</option>
                            <option value="P50">Percentil 50</option>
                            <option value="P90">Percentil 90</option>
                        </select>
                        <br><br>

                        <b>Seleccionar Periodo de Retorno (TR):</b>
                        <br>
                        <select id="select_tr" style="width: 70%;">
                            <option value="LM_TR2">TR 2</option>
                            <option value="LM_TR5">TR 5</option>
                            <option value="LM_TR10">TR 10</option>
                            <option value="LM_TR30">TR 30</option>
                            <option value="LM_TR50">TR 50</option>
                            <option value="LM_TR75">TR 75</option>
                            <option value="LM_TR100">TR 100</option>
                            <option value="LM_TR200">TR 200</option>
                            <option value="LM_TR500">TR 500</option>
                            <option value="LM_TR1000">TR 1000</option>
                        </select>
                        <br><br>

                        <div><button id="generate" onclick="generar_tb_pp()">Generate</button></div>
                        <!-- <div id="sendbbox"></div> -->
                        <!-- <div id="control_aoi" onclick="sendbbox()"><br>
                                <input class="button is-primary" type="submit" value='Generar Tabla'>
                        </div> -->

                        <br><br>

                        <div id="tabla_datos"></div>
                        <br>
                        <button onclick="exportTableToExcel('tabla_datos')">Exportar a Excel</button>

                    </div>
                    <div class="sidebar_ol-pane" id="lluvias_graficos"><h1 class="sidebar_ol-header">Gráficos<span class="sidebar_ol-close"><i class="fa fa-caret-left"></i></span></h1>

                        <br><br>
                        <button class="btn btn-primary btn-lg" id="render_btn">Generar gráfico</button>
                        <canvas id="graph_ddf" width="400" height="400"></canvas>

                    </div>
                    <!-- <div class="sidebar_ol-pane" id="messages"><h1 class="sidebar_ol-header">Messages<span class="sidebar_ol-close"><i class="fa fa-caret-left"></i></span></h1></div>
                    <div class="sidebar_ol-pane" id="settings"><h1 class="sidebar_ol-header">Settings<span class="sidebar_ol-close"><i class="fa fa-caret-left"></i></span></h1></div> -->
                </div>
            </div>


            
        </div>
        <div id="nodelist" style="display:none" class="table-responsive"></div>

        
    </div>
    <!-- <div class="sidepanel_n">
        <span class="sidepanel_n-title">Side Panel</span>
    </div> -->
    <!-- end #content -->
    <!-- end #content -->
    <!-- begin theme-panel -->
    
    <div class="theme-panel" style="margin-top: 80px"> <!-- <div class="theme-panel active" style="margin-top: 80px"> -->
    <a href="javascript:;" data-click="theme-panel-expand" class="theme-collapse-btn"><i class="fa fa-cog"></i></a>
    <div class="theme-panel-content">
        <ul class="theme-list clearfix">
            <li><a href="http://idesep.senamhi.gob.pe/geonetwork/" target="_blank">Metadato</a></li>
        </ul>
        
        <div class="row m-t-10">
            <div class="panel-group" id="accordion">
                <div class="panel panel-inverse overflow-hidden">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                        <a class="accordion-toggle accordion-toggle-styled" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            <i class="fa fa-plus-circle pull-right"></i>
                            Leyenda
                        </a>
                        </h3>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in"> <!--<div id="collapseOne" class="panel-collapse collapse">-->
                    <div id="legend">
                        <img src="http://idesep.senamhi.gob.pe/geoserver/g_00_02/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=g_00_02:00_02_002_03_000_000_0000_00_00">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- end theme-panel -->
<!-- begin scroll to top btn -->

<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
<!-- end scroll to top btn -->

<!-- end page container -->
<!-- ================== BEGIN BASE JS ================== -->

<!-- ================== BEGIN BASE JS ================== -->
<script src="assets/plugins/jquery/jquery-1.9.1.min.js"></script>
<script src="assets/plugins/jquery/jquery-migrate-1.1.0.min.js"></script>
<script src="assets/plugins/jquery-ui/ui/minified/jquery-ui.min.js"></script>
<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<!--[if lt IE 9]>
<script src="assets/crossbrowserjs/html5shiv.js"></script>
<script src="assets/crossbrowserjs/respond.min.js"></script>
<script src="assets/crossbrowserjs/excanvas.min.js"></script>
<![endif]-->
<script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="assets/plugins/jquery-cookie/jquery.cookie.js"></script>
<!-- ================== END BASE JS ================== -->
<!-- ================== END BASE JS ================== -->
<!-- ================== BEGIN PAGE LEVEL JS ================== -->
<script src="assets/js/apps.min.js"></script>
<script src="assets/js/map-ol3.min.js"></script>
<script src="assets/js/ol3-sidebar.js"></script>
<script src="assets/js/elm-pep.js"></script>
<!-- ================== END PAGE LEVEL JS ==================== -->
<script>
    $(document).ready(function () {
        App.init();
        //variable iniciales
        var proyeccion = $("#proyeccion").val();
        var extent = JSON.parse($("#extent").val());
        var presicionDecimal = $("#presicion_decimal").val();
        var wmsCurrent = $("#url").val();
        var layerCurrent = $("#lyr").val();
        var layerCurrentTitle = $("#nomlyr").val();//$("#titulo_tematico").val().toUpperCase();
        var wmsMapaBase = $("#url").val();
        var keyBingMap = $("#key_bing_map").val();
        var dominio = $("#dominio").val();
        MapOpenLayer.init(proyeccion, extent, presicionDecimal, wmsCurrent, layerCurrent, layerCurrentTitle, wmsMapaBase, keyBingMap, dominio);
    });
</script>


<script>
    var data_regiones = JSON.parse(datos_regiones)[0];
    console.log(data_regiones);

    var q_pp = JSON.parse(quantiles_pp);
    var trs = q_pp["features"][0]["properties"];
    console.log(trs);

    var generar_tb_pp = function() {
        var region = "A1";//document.getElementById('select_quantil').value;
        var quantil = document.getElementById('select_quantil').value;
        var percentil = document.getElementById('select_percentil').value;
        var tr = document.getElementById('select_tr').value;
        var val_temp;

        console.log(trs[tr]);
        console.log(data_regiones["A1"][quantil][percentil]);

        var tabla_datos = "<table border=1 width=80%>";
        tabla_datos += "<tr><th align=center>Horas</th><th align=center>"+percentil+"</th><th align=center>PP</th><th align=center>"+trs[tr].toFixed(2)+"</th></tr>"
        for(j=0;j<=23;j++){
            var n = j+1
            // console.log(q_pp[tr])
            var val_pp = data_regiones["A1"][quantil][percentil];
            var val_hiet = (val_pp[j]*trs[tr]).toFixed(2);
            if(n==1){
                val_temp = val_hiet
            }else{
                val_temp = val_pp[j]*trs[tr] - val_pp[j-1]*trs[tr]
            };
            console.log(val_temp);
            tabla_datos += "<tr><td align=center>"+n+"</td><td align=center>"+ val_pp[j] +"</td><td align=center>"+val_hiet+"</td><td align=center>"+parseFloat(val_temp).toFixed(2)+"</td></tr>";
            // val_temp = parseFloat(val_hiet) - val_temp
        }
        tabla_datos += "</table>";
        document.getElementById("tabla_datos").innerHTML = tabla_datos;

    }

    var exportTableToExcel = function(tableID, filename = ''){
        var downloadLink;
        var dataType = 'application/vnd.ms-excel';
        var tableSelect = document.getElementById(tableID);
        var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
        
        filename = filename?filename+'.xls':'excel_data.xls';
        downloadLink = document.createElement("a");
        
        document.body.appendChild(downloadLink);
        
        if(navigator.msSaveOrOpenBlob){
            var blob = new Blob(['\ufeff', tableHTML], {
                type: dataType
            });
            navigator.msSaveOrOpenBlob( blob, filename);
        }else{
            downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
            downloadLink.download = filename;
            downloadLink.click();
        }
    }
</script>
<script>
    var create_graph = function() {
        var region = "S3";//document.getElementById('select_quantil').value;
        var quantil = document.getElementById('select_quantil').value;
        var percentil = document.getElementById('select_percentil').value;
        var tr = document.getElementById('select_tr').value;
        var val_temp;

        var graph = document.getElementById("graph_ddf");
        var q_pp = JSON.parse(quantiles_pp);

        var trs = q_pp["features"][0]["properties"];
        var val_pp = data_regiones[region][quantil][percentil];
        
        var lista_horas = [];
        var lista_perc = [];
        var lista_hiet = [];
        var lista_pp = [];

        for(j=0;j<=23;j++){
                var n = j+1;
                lista_horas.push(String(n));
                var val_hiet = (val_pp[j]*trs[tr]).toFixed(2);
                if(n==1){
                    val_temp = val_hiet;
                }else{
                    val_temp = val_pp[j]*trs[tr] - val_pp[j-1]*trs[tr];
                };
                lista_pp.push(val_temp);
            };

        Chart.defaults.global.defaultFontFamily = "Lato";
        Chart.defaults.global.defaultFontSize = 12;

        var dataFirst = {
            label: "Hietograma de tormenta",
            data: lista_pp,
            lineTension: 0,
            fill: false,
            backgroundColor: "#3e95cd"
          };

        var chartData = {
            labels: lista_horas,
            datasets: [dataFirst]
        };

        var chartOptions = {
          scales: {
            xAxes: [{
              barPercentage: 1,
              scaleLabel: {
                display: true,
                labelString: "Tiempo (Horas)"
              }
            }],
            yAxes: [{
              id: "y-axis-density",
              scaleLabel: {
                display: true,
                labelString: "Precipitación (mm)"
              }
            }]
          }
        };

        const ctx = document.getElementById("graph_ddf").getContext('2d');

        var lineChart = new Chart(graph, {
          type: 'bar',
          data: chartData,
          options: chartOptions
        });
    };

    $(document).ready(function() {
      $("#render_btn").on("click", function(e) {
        e.preventDefault();
        create_graph();
        // console.log(chartData);

        // graph_ddf.data = chartData;
        graph_ddf.update();

      });
    });
    
</script>
</body>
</html>
